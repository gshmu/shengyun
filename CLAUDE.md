# Shengyun 声韵输入方案 - 开发文档

## 项目概述

声韵拼音输入方案：基于 RIME/Trime 的声韵分层输入法，将汉语拼音分为声母和韵母两层键盘，实现两步输入。

**项目类型**：纯配置方案（YAML），无需编译
**目标用户**：学习拼音的孩子
**依赖**：Trime 输入法 + RIME 引擎
**许可证**：GPL-3.0-or-later

---

## 开发环境配置

### 网络代理设置

项目开发过程中如需访问外部资源，可配置代理：
**代理地址**：`100.64.0.239:7897`（支持 HTTP/HTTPS/SOCKS）

### 技术栈

- **RIME**：拼音处理、词库匹配（librime）
- **Trime**：Android 前端、键盘渲染
- **Python**：配置生成工具（PyYAML）
- **数据源**：pinyin.info（409个拼音组合）

---

## 使用

### 一键部署
```bash
./generator/deploy.sh
```

---

## 韵母层键盘布局设计

### 设计原则

1. **无重复原则**：每个韵母在键盘上只出现一次
2. **关联性原则**：垂直列对应关系，便于记忆
3. **互补分布**：uan/üan、un/ün 共用位置（不同声母层显示不同）
4. **层次结构**：
   - 列1垂直：er → i → u → ü（基础元音）
   - 行1隔列：er, a, 空, o, 空, e（单韵母aoe隔列显示）
   - 行2列2：ai（固定位置）
   - 行4底部：ang, eng, ing, ong（后鼻音）

**设计原则**：
- **如实显示韵母本身**：韵母层显示韵母的实际发音形式（ü/ün/üe/üan）
- **输入码遵循 RIME 规范**：所有 ü 统一用 v 表示
- **与书写规则无关**：不考虑声韵组合后的书写变化（如 ju 书写时省略 ü 上的两点）

### 声母专用韵母层规则

**左上角(1,1)显示规则**：
- **通用层**：显示"er"并可点击
- **声母层**：显示当前声母（如"b"、"zh"），不可点击，纯提示作用

**标签显示规则**：
- 所有韵母按键只显示韵母部分（如"a"、"an"、"ang"）
- **j/q/x/y 层特殊规则**：如实显示 ü 系韵母（ü/ün/üe/üan）
- **其他声母层**：互补分布（ün→un, üan→uan）

**输入码规则**：
- 所有 ü 系韵母统一用 v 表示（RIME 标准）
- j/q/x/y 层：jv/jvn/jve/jvan（显示 ü/ün/üe/üan）
- 其他声母层：lv/lun/luan（显示 ü/un/uan）

---

## 版本历史

### v2.0.0 (2025-11-18)
- ✅ 基于 pinyin.tsv 的白名单配置（409个拼音组合）
- ✅ 自动互斥韵母处理（un/vn, uan/van）
- ✅ 一键部署脚本（生成→打包→推送）
- ✅ 模块化目录结构（generator/ + rime/）

### v1.1.0 (2025-11-15)
- 配置驱动韵母层生成（finals_mask_config.yaml）
- 修复 ün/un 互补分布
- 声母层标点输入支持

### v1.0.0 (2025-11-14)
- 完成声韵组合规则矩阵（23声母 × 39韵母）
- 实现自动键盘切换
- 纯拼音界面设计

---

## Lua 自动键盘切换失败记录（已废弃）

**时间**: 2025-11-15
**错误**: `LuaProcessor::ProcessKeyEvent error(2): attempt to call a nil value`
**结论**: 无法定位根本原因，已放弃 Lua 方案，改用纯 Trime 配置。

---

**Claude Code 项目文档** | 声韵输入方案 | Updated: 2025-11-18
