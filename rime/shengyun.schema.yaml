# SPDX-FileCopyrightText: 2025 Shengyun IME
# SPDX-License-Identifier: GPL-3.0-or-later

# 声韵输入法方案
# encoding: utf-8

schema:
  schema_id: shengyun
  name: 声韵拼音
  version: "1.0.2"
  author:
    - gshmu (https://gshmu.com)
  description: |
    声母+韵母分层输入的拼音方案
    专为学习拼音的幼儿园儿童设计
  dependencies:
    - terra_pinyin

switches:
  - name: ascii_mode
    reset: 0
    states: [ 中文, 西文 ]
  - name: full_shape
    states: [ 半角, 全角 ]
  - name: simplification
    reset: 1
    states: [ 漢字, 汉字 ]
  - name: ascii_punct
    reset: 0
    states: [ 。，, ．， ]

engine:
  processors:
    - ascii_composer
    - recognizer
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - punct_segmentor
    - fallback_segmentor
  translators:
    - punct_translator
    - script_translator
  filters:
    - simplifier
    - uniquifier

speller:
  alphabet: zyxwvutsrqponmlkjihgfedcba1234
  delimiter: " '"
  algebra:
    # 最小化必需规则（零容错）

    # 1. 键盘输入必需：v 代表 ü
    - derive/ü/v/

    # 2. 声调省略（词典带声调，必须支持无声调输入）
    - derive/^([a-z]+)[0-5]$/$1/

translator:
  dictionary: terra_pinyin
  prism: shengyun
  spelling_hints: 8
  enable_completion: false  # 禁用补全
  enable_sentence: true  # 允许整句输入
  preedit_format:
    # 显示格式化：在输入区显示正确的拼音形式
    - xform/([nl])v/$1ü/
    - xform/([nl])ue/$1üe/
    - xform/([jqxy])v/$1u/
  comment_format:
    # 候选词注释格式化：显示带声调的拼音
    - xform/([nl])v/$1ü/
    - xform/([jqxy])v/$1u/

punctuator:
  import_preset: default

key_binder:
  import_preset: default
  bindings:
    # 声韵输入法专用快捷键
    - { when: composing, accept: Control+Shift+1, toggle: ascii_mode }
    - { when: composing, accept: Control+Shift+2, toggle: full_shape }
    - { when: composing, accept: Control+Shift+3, toggle: simplification }
    - { when: composing, accept: Control+Shift+4, toggle: ascii_punct }

recognizer:
  import_preset: default
  patterns:
    punct: "^/([0-9]0?|[a-z]+)$"
    reverse_lookup: "`[a-z]*'?$"
